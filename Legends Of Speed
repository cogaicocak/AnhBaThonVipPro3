-- Function chính chứa toàn bộ auto farm
local function startAutoFarm()
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local RunService = game:GetService("RunService")
    local Workspace = game:GetService("Workspace")
    local Players = game:GetService("Players")
    local rEvents = ReplicatedStorage.rEvents

    local OrbArgs = {
        ["Red"] = {[1] = "collectOrb", [2] = "Red Orb", [3] = "City"},
        ["Yellow"] = {[1] = "collectOrb", [2] = "Yellow Orb", [3] = "City"},
        ["Blue"] = {[1] = "collectOrb", [2] = "Blue Orb", [3] = "City"},
        ["Orange"] = {[1] = "collectOrb", [2] = "Orange Orb", [3] = "City"},
        ["Gems"] = {[1] = "collectOrb", [2] = "Gem", [3] = "City"}
    }

    local RebirthArgs = {[1] = "rebirthRequest"}
    local RaceArgs = {[1] = "joinRace"}

    local function createOrbCollector(orbType)
        coroutine.wrap(function()
            while true do
                rEvents.orbEvent:FireServer(unpack(OrbArgs[orbType]))
                RunService.Heartbeat:Wait()
            end
        end)()
    end

    coroutine.wrap(function()
        while true do
            for _, v in pairs(Workspace:GetDescendants()) do
                if v.Name == "finishPart" then
                    local character = Players.LocalPlayer.Character
                    if character and character:FindFirstChild("HumanoidRootPart") then
                        firetouchinterest(character.HumanoidRootPart, v, 0)
                        task.wait(0.1)
                        firetouchinterest(character.HumanoidRootPart, v, 1)
                    end
                end
            end
            task.wait(0.5)
        end
    end)()

    createOrbCollector("Red")
    createOrbCollector("Yellow")
    createOrbCollector("Blue")
    createOrbCollector("Orange")
    createOrbCollector("Gems")

    coroutine.wrap(function()
        while true do
            rEvents.rebirthEvent:FireServer(unpack(RebirthArgs))
            RunService.Heartbeat:Wait()
        end
    end)()

    coroutine.wrap(function()
        while true do
            rEvents.raceEvent:FireServer(unpack(RaceArgs))
            RunService.Heartbeat:Wait()
        end
    end)()
end

while true do
    startAutoFarm()
    task.wait(5)
end
